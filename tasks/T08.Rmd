---
title: "Task 8"
author: "GEOG-490R"
date: "Spring 2024"
output: 
  html_document:
    code_folding: hide
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr);library(ggplot2);library(terra)
```

### Avalanche Analysis

Over the last few weeks you have learned to work with the two main spatial data formats (vector & raster) in R and have performed basic spatial analysis with vector objects. This assignment will continue exploring spatial analysis and add interesting aspects of  raster and terrain analysis.

Your task this week is to use both csv, vector, and raster datasets to better understand avalanches in the state and spatially assess avalanche hazard in the Salt Lake region.

\

#### 1. Avalanche Reports

Read in the "avalanche_2000_2024" csv file. You are going to investigate the frequency and distributions of avalanches in Utah. This data was downloaded directly from the UAC site.

```{r}
avy <- read.csv("https://raw.githubusercontent.com/mattols/geospat_data/main/avalanches_2012_2024.csv")
```


1. *(5 points)* Create four separate bar plots or histograms showing: 1) total number of avalanches by year, 2) total number of avalanches by month, and 2) total number of avalanches in each region, and 4) All avalanches (count) by date for the 2020-2021 season (recall that a season starts and ends on Oct 1st). Based on this analysis alone, write a short description (2-4 sentences) describing the frequency and distribution of avalanches in Utah.

**Functions used:** *expand to reveal the functions I used in my solution*
```{r}
# I only used the following functions:
#  - mutate(), as.Date(), group_by(), format(), filter(), summarise()
#  - ggplot(), geom_bar(), geom_hist(), theme()

# remember, there's more than one way to do it!
```

- 1-Advanced. *(****required for advanced students*** - *optional for other students)* Analyze incidents where individuals were caught, carried, buried, or killed. Assume that any instance where an individual was buried or killed that they were also caught and carried. Similarly, assume that anyone killed was likely buried (this is not necessarily true as some fatalities are due to collision). What is the probability of being caught and buried (both fully and partially) in an avalanche in Utah? What is the probability of being buried and killed? Use this information to write a well-formed statistical statement about avalanche risk.

\


#### 2. Avalanche Hazard 

Download this [DEM]("https://github.com/mattols/geospat_data/raw/main/ASTGTM2_N40W112_dem.tif") that covers part of the Wasatch Range, along with Salt Lake and Utah valley. This ASTER DEM is a remote sensing product with a resolution of ~30-meters spatial resolution and lists elevation in meters above sea level.

Crop the extent to the following: `xmin = -111.85, xmax = -111.50, ymin = 40.50, ymax = 40.75` and create a hillshade map. This can be used in your visualizations. 

You will use the elevation information to recreate zones of hazard that can easily line up with the avalanche forecast

2. *Slope.* As stated in the guide, slope is the primary factor that determines where avalanches occur. Avalanches only occur on slope angles 30-45ยบ. Create two plots, 1) showing the slope angle for the cropped DEM (with an applied color scheme - use the color cheatsheet), and 2) a map that clearly shows pixels that are within the slope hazard (i.e. a hillshade with hazardous slopes in red).

3. *Elevation.* Elevation is a secondary, but important factor in determining avalanche hazard. Elevation hazard varies from day-to-day and across different zones of elevation. Revisit the [UAC forecast tutorial](https://utahavalanchecenter.org/forecast/tutorial) page and look at the rose diagram. There are three elevation zones in the UAC forecasts. Use the zones defined in the UAC rose diagram to create a map showing each zone in a new color. Choose green for low-elevations, yellow for mid-elevations, and orange for high-elevations. No need to include anything under 5,000 ft. Additionally, list the area of each zone in square kilometers.

**Solution hints:** *expand to reveal the functions I used in my solution*
```{r}
# If you're not sure where to start:
#  - Use raster algebra to convert the DEM elevation from meters to feet
#  - Use either boolean expression or the classify function to define elevation zones
#  - for area estimation, you can either:
#      1) extract the values() and find the number of pixels with each value
#      2) use the terra::freq() function to count values
#         lastly, convert pixel size to km^2 using the pixel size mentioned above

# remember, there's more than one way to do it!
```

4. *Aspect.* Similar to elevation, aspect hazard varies day-to-day and across elevation zones. Reclassify the DEM into cardinal zones of North (1), NE (2), East (3), SE (4), South (5), SW (6), West (7), and NW (8). Plot this using an array of distinct colors.


Now that you have all three key pieces of terrain information, you can combine information to assess avalanche hazard. Revisit your avalanche observation data to gather a bit more information and also to create a spatial object.

*Filter* the avalanche data to only include the 2020-2021 season in the "Salt Lake" Region. Use this information to help with answering the next two questions

5. Create histrograms or bar charts for the Salt Lake 2020-2021 season that show: 1) the frequency of avalanches by aspect, and 2) the number of avalanches by month for this season. Alternatively, combine this information into one plot. What are the "hot" months and aspects for avalanches during this time period in this location?

6. *(2 points)* Create two map plots by combining your raster layers above to highlight: 1) the aspect that experienced most avalanches during the month with the most avalanches for this area and seaosn, and 2) The second most frequent aspect to experience avalanches during the highest month of avalanches. You can include all elevation zones and slopes prone to avalanching. *If you're not sure where to start, revisit the help guide.*

With the avalanche data, clean and use the Coordinates attribute to convert this layer into a `vect()` object. 

7. *(2 points)* Create a map plot with your new vect avalanche object showing Aspect over the hillshade map of the area. Discuss the distribution of observations and how they align with your maps in the previous question. 


#### extract slope and aspect of ski resorts

8. ski areas

#### extract slope and aspect of ski resorts


#### 3. Hazard Modeling

One benefit of using R to do this is that we can create a custom function that will take the avalanche forecast conditions for a given day and produce a hazard map that can be used to warn others of hazardous terrain.

This will require some amount of basic modeling. In our case, we will create a simple avalanche hazard model that combines all three layers together based on the avalanche forecast to produce a hazard map.

8. *(4 points)* Create a function that uses your DEM and reclassfied layers in combination with a forecast to create a unique hazard map for [Feb 6, 2021](https://utahavalanchecenter.org/forecast/salt-lake/2/6/2021) and [Feb 10, 2021](https://utahavalanchecenter.org/forecast/salt-lake/2/10/2021). This will require you to create a basic avalanche hazard model that uniquely combines all layers together in a way that you can assign the hazard to each aspect and elevation for any suitable slope. Be sure to follow teh same hazard levels and color code that the UAC uses.

**Solution hints:** *expand to reveal a little help*
```{r}
# some ideast:
#  - revisit the guide again to think about combining layers
#  - you will create a new function that combines slope, aspect, and elevation and provides a value that can be determined low, moderate, considerable, high, and extreme danger
#  - Consider several arithmetic operators 
#  - It may be useful if your different layer have different ranges (for example aspects could be in 10s rather than increments of 1 before combining layers)
#  - test and assess to see if your results are valid.

# One possible combination is (elevation + aspect) * slope - however, you will need to make sure that elevation and aspect are distinct ranges so that all unique values can be acheived

# remember, there's more than one way to do it!
```

- 9-Advanced. *(****required for advanced students*** - *optional for other students)* Look through the [UAC archives](https://utahavalanchecenter.org/archives/forecasts) and select any week of forecasts (7 consecutive days). Be sure to choose a time frame where avalanche conditions show interesting change. Run your function for these days and show and describe how the hazard evolves over this time period.

or

- 9-Advanced. *(****required for advanced students*** - *optional for other students)* Look

#### assess the point data???

FOr the month with the most avalanches, which 



\




6. What other questions could you address with this dataset?

\

#### Submitting

Upload your R Markdown output as an html file to Canvas

\

**This assignment is due in one week but may be turned for an additional week with a late penalty of -5%**

\


